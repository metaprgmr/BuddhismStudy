<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<title>地藏菩薩本願經科註</title>
<link rel="stylesheet" href="../books/book.css">
<script src="../../../util/utils.js"></script>
<script src="../../../env.js"></script>
<script src="../../../佛學基礎/《地藏菩薩本願經》/QingLian/dzjkz-common.js"></script>
<script src="../mybfnn.js"></script>
</head>
<body link=blue vlink=purple background="../books/textbackground.jpg" class="Normal">
<div id="stg"></div>
</body></html>

<script>
const TOCContent = `
　　　　<a href="?vol=A">序</a>　　　　　　<br>
卷一　　忉利天宮神通品　<a href="?vol=1">第一</a>　<br>
　　　　分身集會品　　　<a href="?vol=1&pin=2">第二</a>　<br>
卷二　　觀眾生業緣品　　<a href="?vol=2">第三</a>　<br>
　　　　閻浮眾生業感品　<a href="?vol=2&pin=4">第四</a>　<br>
卷三　　地獄名號品　　　<a href="?vol=3">第五</a>　<br>
　　　　如來讚歎品　　　<a href="?vol=3&pin=6">第六</a>　<br>
卷四　　利益存亡品　　　<a href="?vol=4">第七</a>　<br>
　　　　閻羅王眾讚歎品　<a href="?vol=4&pin=8">第八</a>　<br>
　　　　稱佛名號品　　　<a href="?vol=4&pin=9">第九</a>　<br>
卷五　　較量布施功德緣品<a href="?vol=5">第十</a>　<br>
　　　　地神護法品　　　<a href="?vol=5&pin=11">第十一</a><br>
卷六　　見聞利益品　　　<a href="?vol=6">第十二</a><br>
　　　　囑累人天品　　　<a href="?vol=6&pin=13">第十三</a><br>
　　　　<a href="?vol=Z">後跋</a>　　　　　　　　　<br>`.trim();

function showTOC() {
  var buf = new Buffer();
  docInfo.setBuffer(buf).set('defaultClass', 'TEXTC').setXG(true)
         .writeDoc('地藏菩薩本願經科注', `
/TEXT030C/古鹽匡菴 青蓮苾芻　靈椉父 輯

${TOCContent}<br>
`);
  buf.render('stg');
} // showTOC().

function showVol(vol, pin) {
  addjs(`../../../佛學基礎/《地藏菩薩本願經》/QingLian/dzjkz${vol}.js`);
  var timer = setInterval(() => {
    if (VOLUMES.length == 0) return; // not ready yet
    for (var i in VOLUMES) bfnnShow(VOLUMES[i], vol, pin);
    clearInterval(timer);
  }, 300);
  return true;
}

function bfnnShow(volume, vol, pin) {
  var buf = new Buffer();
  new (class extends DocInfo {
    constructor() {
      super();
      this.setBuffer(buf).setXG().reInit(9098, 6, vol);
      var vdisp = this.getVolDisp();
      this.writeStart(`地藏菩薩本願經科注||${vdisp}`, `地藏經科注${vdisp}`)
          .w(SP, '<p class=TEXT030C>古鹽匡菴 青蓮苾芻　靈椉父 輯</p>', SP);
      if (vol == 'A' || vol == 'Z') {
        this.writeBody(volume, true);
        return;
      }

      // regular volumes
      for (var i in volume.pins) {
        var p = volume.pins[i];
        for (var k in p.lines) {
          var li = p.lines[k];
          if (!nokp || !li.isKePan())
            this.w(li.toDisp(), SP);
        }
      }
      this.w(`<p class=TEXT030 align=right>地藏菩薩本願經科注 卷${volume.volNum}　</p>`, SP)
          .writeEnd();
    }

    getVolDisp() {
      switch(this.volNum) {
      case 'A': return '序';
      case 'Z': return '後跋';
      }
      return '卷' + zNumber(this.volNum);
    }

    writeSeriesNav(links) {
      var id = this.getVolDisp();
      this.w('<center><hr class=volsep>', TOCContent.replace(id, `<cur>${id}</cur>`), '</center>');
    }

    addMyTips() {
      var a = getGlobal('DZJKZ_TIPS');
      if (!a) return;
      a = a.split('\n');
      for (var i in a) this.addTip(a[i]);
    }
  })();
  buf.render('stg');
  pin && showTop('品'+zNumber(pin));
}

var nokp = get('nokp'), vol = get('vol'), pin = get('pin');
vol && showVol(vol, pin) || showTOC();
</script>
